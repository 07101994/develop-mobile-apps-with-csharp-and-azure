<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Best Practices - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter2/bestpractices/">
      
      
        <meta name="author" content="Adrian Hall">
      
    
    <meta property="og:url" content="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter2/bestpractices/">
    <meta property="og:title" content="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure">
    <meta property="og:image" content="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter2/bestpractices//../../">
    <meta name="apple-mobile-web-app-title" content="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-a422ff04cc.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Chapter 2 - Authentication <i class="icon icon-link"></i>
              
            
          </span>
        
        Best Practices
      </div>
    </div>
    
      
      <div class="button button-twitter" role="button" aria-label="Twitter">
        <a href="https://twitter.com/FizzyInTheHall" title="@FizzyInTheHall on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
      </div>
    
    
      
      <div class="button button-github" role="button" aria-label="GitHub">
        <a href="https://github.com/adrianhall" title="@adrianhall on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
      </div>
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          adrianhall/develop-mobile-apps-with-csharp-and-azure
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Getting Started" href="../..">
      Getting Started
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Chapter 1 - Introduction</span>
    <ul>
      
        
  <li>
    <a class="" title="Your First App - PC Edition" href="../../chapter1/firstapp_pc/">
      Your First App - PC Edition
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Your First App - Mac Edition" href="../../chapter1/firstapp_mac/">
      Your First App - Mac Edition
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 2 - Authentication</span>
    <ul>
      
        
  <li>
    <a class="" title="Concepts" href="../authconcepts/">
      Concepts
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Authentication in the Backend" href="../backend/">
      Authentication in the Backend
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Enterprise Authentication" href="../enterprise/">
      Enterprise Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Social Authentication" href="../social/">
      Social Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Debugging Authentication" href="../debugging/">
      Debugging Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Custom Authentication" href="../custom/">
      Custom Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Claims and Authorization" href="../authorization/">
      Claims and Authorization
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Tokens in Real Apps" href="../realworld/">
      Tokens in Real Apps
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Best Practices" href="./">
      Best Practices
    </a>
    
      
      
        <ul>
          
            <li class="anchor">
              <a title="Best Practices" href="#best-practices">
                Best Practices
              </a>
            </li>
          
            <li class="anchor">
              <a title="Authenticating Your App" href="#authenticating-your-app">
                Authenticating Your App
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 3 - Data Access and Offline Sync</span>
    <ul>
      
        
  <li>
    <a class="" title="Concepts" href="../../chapter3/dataconcepts/">
      Concepts
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Implementing Table Controllers" href="../../chapter3/server/">
      Implementing Table Controllers
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Data Projection and Queries" href="../../chapter3/projection/">
      Data Projection and Queries
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="The Mobile Client" href="../../chapter3/client/">
      The Mobile Client
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Relationships" href="../../chapter3/relationships/">
      Relationships
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="The Domain Manager" href="../../chapter3/domainmgr/">
      The Domain Manager
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="File Management" href="../../files/">
      File Management
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Push Notifications" href="../../push/">
      Push Notifications
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Server Side Code" href="../../custom/">
      Server Side Code
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Media Services" href="../../media/">
      Media Services
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Leveraging Search" href="../../search/">
      Leveraging Search
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Web and Mobile Apps" href="../../combined/">
      Web and Mobile Apps
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="The Development Environment" href="../../developing/">
      The Development Environment
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Testing your Application" href="../../testing/">
      Testing your Application
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Troubleshooting" href="../../troubleshooting/">
      Troubleshooting
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Going to Production" href="../../production/">
      Going to Production
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Xamarin Forms Tips" href="../../xamarin_tips/">
      Xamarin Forms Tips
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Android Developer Notes" href="../../android_appendix/">
      Android Developer Notes
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="References" href="../../references/">
      References
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Credits" href="../../credits/">
      Credits
    </a>
    
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
              
              <li>
                <a href="https://twitter.com/FizzyInTheHall" target="_blank" title="@FizzyInTheHall on Twitter">
                  @FizzyInTheHall on Twitter
                </a>
              </li>
            
            
              
              <li>
                <a href="https://github.com/adrianhall" target="_blank" title="@adrianhall on GitHub">
                  @adrianhall on GitHub
                </a>
              </li>
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
            <h1>Best Practices</h1>
          
          <h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<p>We've covered a lot of ground with authentication and authorization, so I wanted to cover some of the
best practices that I generally advise when thinking about this topic.</p>
<h3 id="dont-store-passwords">Don't store passwords<a class="headerlink" href="#dont-store-passwords" title="Permanent link">&para;</a></h3>
<p>I can't really advise on which identity provider is best for your mobile application.  However, I can
clearly say that delegating the security of the identity database to someone who has that as their full
time job is an excellent idea.</p>
<p>Choosing an identity provider is not easy.  Here are my choices:</p>
<ol>
<li>If you need enterprise authentication, use <strong>Azure Active Directory</strong>.</li>
<li>If you need a specific social identity provider (for example, Facebook or Google), use that.</li>
<li>If you need multiple social identity providers, <strong>Auth0</strong> is an excellent choice.</li>
<li>If you need usernames and password, use <strong>Azure Active Directory B2C</strong>.</li>
</ol>
<p>Storing usernames and passwords in your own database is a bad idea and should be avoided.</p>
<h3 id="use-the-client-sdk-provided-by-the-identity-provider">Use the client SDK provided by the Identity Provider<a class="headerlink" href="#use-the-client-sdk-provided-by-the-identity-provider" title="Permanent link">&para;</a></h3>
<p>Your first step should be getting an access token from the identity provider itself.  You will see the
most integrated experience if you use their SDK.</p>
<ol>
<li>For <strong>Azure Active Directory</strong>, that SDK is <a href="https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/">ADAL</a>.</li>
<li>For <strong>Facebook</strong>, check out <a href="https://www.nuget.org/packages/Xamarin.Facebook.iOS/">Xamarin.Facebook.iOS</a> or <a href="https://www.nuget.org/packages/Xamarin.Facebook.Android/">Xamarin.Facebook.Android</a>.</li>
<li>For <strong>Google</strong>, check out <a href="https://www.nuget.org/packages/Google.Apis.Core/">Google APIs Core Client Library</a>.</li>
<li>For <strong>Auth0</strong>, check out the <a href="https://components.xamarin.com/view/auth0client">Auth0 Xamarin Component</a>.</li>
<li>For <strong>Azure Active Directory B2C</strong>, use <a href="https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/">ADAL</a>.</li>
</ol>
<h3 id="swap-the-identity-provider-access-token-for-a-zumo-token">Swap the Identity Provider access token for a ZUMO token.<a class="headerlink" href="#swap-the-identity-provider-access-token-for-a-zumo-token" title="Permanent link">&para;</a></h3>
<p>Never use the token provided by the identity provider for anything other than requesting access to
the resource.  Use a short lived token (an hour is the standard) that is minted just for the purpose
of providing that access.  If you are not using an identity provider that is explicitly supported
by Azure App Service, use a custom authentication provider to mint your own token.</p>
<h3 id="enforce-security-at-the-server">Enforce Security at the Server<a class="headerlink" href="#enforce-security-at-the-server" title="Permanent link">&para;</a></h3>
<p>There is no easy way to say this.  There are bad guys out there, and they are after your data.  You
should not assume that someone is using your client.  It could just be someone with a REST client.
Ensure you enforce security on your server.  You can do this easily by using the <code>[Authorize]</code>
attribute, the <code>[AuthorizeClaims()]</code> attribute we developed in the Authorization section or your
own custom authorization attribute.</p>
<p>Monitoring the server is just as important as enforcing security.  The Azure App Service Authentication
service outputs quite a bit of logging about who is logging in (and who is denied), so you can get some
good intelligence out of the logs when you mine them properly.</p>
<h3 id="securely-store-tokens">Securely Store Tokens<a class="headerlink" href="#securely-store-tokens" title="Permanent link">&para;</a></h3>
<p>The decisions we make are always a trade-off between convenience and security.  One such decision is
if we should store tokens with the app.  On the one hand, it's convenient to allow the app to remember
the login and to not ask us to log in again with each app start.  On the other hand, that fact opens
up a security hole that a determined hacker can exploit.  We can have convenience while still having
security by utilizing the secure stores that each platform provides to store secrets like the access
token.</p>
<h3 id="use-https-only">Use https only<a class="headerlink" href="#use-https-only" title="Permanent link">&para;</a></h3>
<p>This should go without saying.  Always use https communication.  Most security professionals start off
their security career with learning "Security at Rest &amp; Security in Transit".  In practical terms, storing
secrets (like tokens) securely and using HTTPS as a transport mechanism satisfies both claims.</p>
<p>Don't stop with security there though.  HTTPS is just a medium through which secure communications can
take place.  There are a wide range of protocols and ciphers that can be used to encrypt the traffic.
Some are  considered less secure and not to be used.  Azure App Service provides a default set of protocols
and ciphers to support backwards compatibility with older browsers.  You can adjust the ciphers in use
by your App Service.  For information on this, refer to the <a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-app-service-environment-custom-settings/">Azure Documentation</a>.</p>
<h3 id="handle-expiring-tokens">Handle Expiring Tokens<a class="headerlink" href="#handle-expiring-tokens" title="Permanent link">&para;</a></h3>
<p>Unless you are using an identity provider that doesn't support refresh tokens (like Facebook or Twitter),
you should handle refresh tokens by silently calling the refresh action.  Tokens are going to expire.
This is a fact of the token specifications.  You need to deal with expiring tokens and act accordingly.</p>
<p>If you do need to use an identity provider that does not support refresh tokens, you are going to have
to ask for credentials whenever the token expires.  You don't get out of determining the user experience
when tokens expire just because you are using Facebook or Twitter.</p>
<h2 id="authenticating-your-app">Authenticating Your App<a class="headerlink" href="#authenticating-your-app" title="Permanent link">&para;</a></h2>
<p>My final word on authentication has to do with authenticating your app.  I get the same request every
week.  How do I implement an API key for my app?  When I probe a little, I get a few reasons for this
request:</p>
<ol>
<li>I want to ensure my app is the only one accessing my backend because the data is important.</li>
<li>I don't want my users to log in as it is inconvenient.</li>
<li>I want to monetize my app, and I can't do that if anyone can copy it.</li>
</ol>
<p>API keys are used by multi-tenant systems to route requests for data to the appropriate data store.  For
example, the very popular <a href="https://github.com/ParsePlatform/parse-server">Parse Server</a> used to have an API key because all clients connected to the
same <code>parse.com</code> service.  Once the <a href="https://github.com/ParsePlatform/parse-server">Parse Server</a> was open-sourced, the API key went away.  It was no
longer needed to route the request.  In the same way, the Azure App Service has a unique name - the URL
of the service, so it doesn't need an API key to route the information.</p>
<p>An API key does not prevent a rogue client from accessing your data.  If you did use an API key for security,
you can easily get the API key for the app by putting together a "man in the middle proxy".  One such proxy
is <a href="http://www.telerik.com/fiddler">Telerik Fiddler</a>.  One of its features is "Security Testing" which amounts to a man-in-the-middle
decryption technique.  This <a href="https://aurir.wordpress.com/2010/03/22/tutorial-getting-android-emulator-working-with-fiddler-http-proxy-tool/">works with the Android emulator</a> as well.  For iOS, you can use <a href="https://www.charlesproxy.com/documentation/faqs/using-charles-from-an-iphone/">Charles</a>.</p>
<p>So, how do you authenticate your app?  Step back a moment.  What are you monetizing or protecting?  It's
likely the data within the mobile backend.  Protect that data by authenticating your users.   If you absolutely
must monetize your app, then there are ways to do it, and we will discuss those later in the book.</p>
<!-- Links -->
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../realworld/" title="Tokens in Real Apps">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Tokens in Real Apps
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../../chapter3/dataconcepts/" title="Concepts">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Concepts
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = 'adrianhall/develop-mobile-apps-with-csharp-and-azure';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
      <script src="../../js/highlight.pack.js"></script>
    
    
  </body>
</html>