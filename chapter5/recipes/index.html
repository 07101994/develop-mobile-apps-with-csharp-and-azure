<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Push Recipes - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter5/recipes/">
      
      
        <meta name="author" content="Adrian Hall">
      
    
    <meta property="og:url" content="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter5/recipes/">
    <meta property="og:title" content="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure">
    <meta property="og:image" content="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter5/recipes//../../">
    <meta name="apple-mobile-web-app-title" content="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-a422ff04cc.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Chapter 5 - Push Notifications <i class="icon icon-link"></i>
              
            
          </span>
        
        Push Recipes
      </div>
    </div>
    
      
      <div class="button button-twitter" role="button" aria-label="Twitter">
        <a href="https://twitter.com/FizzyInTheHall" title="@FizzyInTheHall on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
      </div>
    
    
      
      <div class="button button-github" role="button" aria-label="GitHub">
        <a href="https://github.com/adrianhall" title="@adrianhall on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
      </div>
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          adrianhall/develop-mobile-apps-with-csharp-and-azure
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Getting Started" href="../..">
      Getting Started
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Chapter 1 - Introduction</span>
    <ul>
      
        
  <li>
    <a class="" title="Your First App - PC Edition" href="../../chapter1/firstapp_pc/">
      Your First App - PC Edition
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Your First App - Mac Edition" href="../../chapter1/firstapp_mac/">
      Your First App - Mac Edition
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 2 - Authentication</span>
    <ul>
      
        
  <li>
    <a class="" title="Concepts" href="../../chapter2/authconcepts/">
      Concepts
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Authentication in the Backend" href="../../chapter2/backend/">
      Authentication in the Backend
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Enterprise Authentication" href="../../chapter2/enterprise/">
      Enterprise Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Social Authentication" href="../../chapter2/social/">
      Social Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Debugging Authentication" href="../../chapter2/debugging/">
      Debugging Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Custom Authentication" href="../../chapter2/custom/">
      Custom Authentication
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Claims and Authorization" href="../../chapter2/authorization/">
      Claims and Authorization
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Tokens in Real Apps" href="../../chapter2/realworld/">
      Tokens in Real Apps
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Best Practices" href="../../chapter2/bestpractices/">
      Best Practices
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 3 - Data Access and Offline Sync</span>
    <ul>
      
        
  <li>
    <a class="" title="Concepts" href="../../chapter3/dataconcepts/">
      Concepts
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Implementing Table Controllers" href="../../chapter3/server/">
      Implementing Table Controllers
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Data Projection and Queries" href="../../chapter3/projection/">
      Data Projection and Queries
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="The Mobile Client" href="../../chapter3/client/">
      The Mobile Client
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Relationships" href="../../chapter3/relationships/">
      Relationships
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="The Domain Manager" href="../../chapter3/domainmgr/">
      The Domain Manager
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 4 - Server Side Code</span>
    <ul>
      
        
  <li>
    <a class="" title="Options for Server Code" href="../../chapter4/options/">
      Options for Server Code
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Custom HTTP Endpoints" href="../../chapter4/custom/">
      Custom HTTP Endpoints
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="WebJobs" href="../../chapter4/webjobs/">
      WebJobs
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Functions" href="../../chapter4/functions/">
      Functions
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Recipes" href="../../chapter4/recipes/">
      Recipes
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 5 - Push Notifications</span>
    <ul>
      
        
  <li>
    <a class="" title="Concepts" href="../concepts/">
      Concepts
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Android Push" href="../android/">
      Android Push
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="iOS Push" href="../ios/">
      iOS Push
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Windows Push" href="../windows/">
      Windows Push
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Push Recipes" href="./">
      Push Recipes
    </a>
    
      
      
        <ul>
          
            <li class="anchor">
              <a title="Marketing Push" href="#marketing-push">
                Marketing Push
              </a>
            </li>
          
            <li class="anchor">
              <a title="Geofenced Push" href="#geofenced-push">
                Geofenced Push
              </a>
            </li>
          
            <li class="anchor">
              <a title="Push to Sync" href="#push-to-sync">
                Push to Sync
              </a>
            </li>
          
            <li class="anchor">
              <a title="Secure Push" href="#secure-push">
                Secure Push
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 6 - Combining Web and Mobile Apps</span>
    <ul>
      
        
  <li>
    <a class="" title="MVC Applications" href="../../chapter6/mvc/">
      MVC Applications
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="jQuery Applications" href="../../chapter6/jquery/">
      jQuery Applications
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Angular Applications" href="../../chapter6/angular/">
      Angular Applications
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="React Applications" href="../../chapter6/react/">
      React Applications
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 7 - Other Useful Services</span>
    <ul>
      
        
  <li>
    <a class="" title="Azure Search" href="../../chapter7/search/">
      Azure Search
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Media Services" href="../../chapter7/media/">
      Media Services
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Real-time Notifications" href="../../chapter7/realtime/">
      Real-time Notifications
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 8 - Developing An App</span>
    <ul>
      
        
  <li>
    <a class="" title="The Development Environment" href="../../chapter8/developing/">
      The Development Environment
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Testing your Application" href="../../chapter8/testing/">
      Testing your Application
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Chapter 9 - Going to Production</span>
    <ul>
      
        
  <li>
    <a class="" title="Repeatable Deployments" href="../../chapter9/arm/">
      Repeatable Deployments
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Safe Deployments" href="../../chapter9/appsvc/">
      Safe Deployments
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Monitoring" href="../../chapter9/monitoring/">
      Monitoring
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Troubleshooting" href="../../chapter9/troubleshooting/">
      Troubleshooting
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Xamarin Forms Tips" href="../../xamarin_tips/">
      Xamarin Forms Tips
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Android Developer Notes" href="../../android_appendix/">
      Android Developer Notes
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Visual Studio Extensions" href="../../vs_extensions/">
      Visual Studio Extensions
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="References" href="../../references/">
      References
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Credits" href="../../credits/">
      Credits
    </a>
    
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
              
              <li>
                <a href="https://twitter.com/FizzyInTheHall" target="_blank" title="@FizzyInTheHall on Twitter">
                  @FizzyInTheHall on Twitter
                </a>
              </li>
            
            
              
              <li>
                <a href="https://github.com/adrianhall" target="_blank" title="@adrianhall on GitHub">
                  @adrianhall on GitHub
                </a>
              </li>
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
            <h1>Push Recipes</h1>
          
          <p>This section is dedicated to exploring various common recipes for push notifications and how we can achieve those recipes through cross-platform code.</p>
<div class="admonition warn">
<p class="admonition-title">Incomplete Section</p>
<p>This section is incomplete and still in progress.  Please do not rely on any information within this section.</p>
</div>
<h2 id="marketing-push">Marketing Push<a class="headerlink" href="#marketing-push" title="Permanent link">&para;</a></h2>
<p>The most common requirement for push notifications is to alert users of a special offer or other marketing information.  The general idea is that
the marketing person will create a "campaign" that includes a push notification.  When the user receives the push notification, they will accept
it.  If a user accepts the push notification, the mobile app will deep-link into a specific page and store the fact that the user viewed the page
within the database.</p>
<p>To implement this sort of functionality within a cross-platform application, we need to implement <strong>Templates</strong>.  We gave demonstrations of the
implementation of the templates while we were discussing the various platform implementations.  However, we didn't actually use them.  A template
is provides by the mobile client when registering.  Let's take a look at a typical template as implemented by each platform:</p>
<p><strong>Android</strong>:</p>
<pre><code class="text">{
    &quot;data&quot;: {
        &quot;message&quot;: &quot;$(message)&quot;,
        &quot;picture&quot;: &quot;$(picture)&quot;,
        &quot;view&quot;: &quot;$(viewid)&quot;
    }
}
</code></pre>

<p><strong>iOS</strong>:</p>
<pre><code class="text">{
    &quot;aps&quot;: {
        &quot;alert&quot;: &quot;$(message)&quot;,
        &quot;picture&quot;: &quot;$(picture)&quot;,
        &quot;view&quot;: &quot;$(viewid)&quot;
    }
}
</code></pre>

<p><strong>Windows</strong>:</p>
<pre><code class="xml">&lt;toast&gt;
    &lt;visual&gt;
        &lt;binding template=&quot;genericTemplate&quot;&gt;
            &lt;image id=&quot;1&quot; src=&quot;$(picture)&quot; /&gt;
            &lt;text id=&quot;2&quot;&gt;$(message)&lt;/text&gt;
        &lt;/binding&gt;
    &lt;/visual&gt;
&lt;/toast&gt;
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Toast, Tile and Badge Schemas</p>
<p>If you want to understand the format of the XML that we are using in the Windows section, it's laid out in the
<a href="https://msdn.microsoft.com/en-us/library/windows/apps/br212853.aspx">MSDN documentation</a>.</p>
</div>
<p>Each of these formats can be specified in the appropriate registration call:</p>
<pre><code class="csharp">    // Android Version
    var genericTemplate = new PushTemplate
    {
        Body = &quot;{\&quot;data\&quot;:{\&quot;message\&quot;:\&quot;$(message)\&quot;,\&quot;picture\&quot;:\&quot;$(picture)\&quot;,\&quot;view\&quot;:\&quot;$(viewid)\&quot;}}&quot;
    };
    installation.Templates.Add(&quot;genericTemplate&quot;, genericTemplate);

    // iOS Version
    var genericTemplate = new PushTemplate
    {
        Body = &quot;{\&quot;aps\&quot;:{\&quot;alert\&quot;:\&quot;$(message)\&quot;,\&quot;picture\&quot;:\&quot;$(picture)\&quot;,\&quot;view\&quot;:\&quot;$(viewid)\&quot;}}&quot;
    };
    installation.Templates.Add(&quot;genericTemplate&quot;, genericTemplate);

    // Windows Version
    var genericTemplate = new WindowsPushTemplate
    {
        Body = &quot;&lt;toast&gt;&lt;visual&gt;&lt;binding template=\&quot;genericTemplate\&quot;&gt;&lt;image id=\&quot;1\&quot; src=\&quot;$(picture)\&quot;/&gt;&lt;text id=\&quot;1\&quot;&gt;$(message)&lt;/text&gt;&lt;/binding&gt;&lt;/visual&gt;&lt;/toast&gt;&quot;
    };
    genericTemplate.Headers.Add(&quot;X-WNS-Type&quot;, &quot;wns/toast&quot;);
    installation.Templates.Add(&quot;genericTemplate&quot;, genericTemplate);
</code></pre>

<p>To push, we can use the same Test Send facility in the Azure Portal.  In the Test Send screen, set the <strong>Platforms</strong> field to be <strong>Custom Template</strong>,
and the payload to be a JSON document with the three fields:</p>
<pre><code class="text">{
    &quot;message&quot;: &quot;Test Message&quot;,
    &quot;picture&quot;: &quot;advertisement1&quot;,
    &quot;viewid&quot;: &quot;advertising&quot;
}
</code></pre>

<p>If you have done all the changes thus far, you will receive the same notification as before.  The difference is that you are pushing a message
once and receiving that same message across all the Android, iOS and Windows systems at the same time.  You no longer have to know what sort
of device your users are holding - the message will get to them.</p>
<p>We can take this a step further, however, by deep-linking.  Deep-linking is a technique often used in push notification systems whereby we present
the user a dialog that asks them to open the notification.  If the notification is opened, they are taken directly to a new view with the appropriate
content provided.</p>
<h3 id="deep-linking-with-android">Deep Linking with Android<a class="headerlink" href="#deep-linking-with-android" title="Permanent link">&para;</a></h3>
<p>Let's start our investigation with the Android code-base.  Our push notification is received by the <code>OnMessage()</code> method within the <code>GcmService</code>
class in the <code>GcmHandler.cs</code> file.  We can easily extract the three fields we need to execute our deep-link:</p>
<pre><code class="csharp">    protected override void OnMessage(Context context, Intent intent)
    {
        var message = intent.Extras.GetString(&quot;message&quot;);
        var picture = intent.Extras.GetString(&quot;picture&quot;);
        var view = intent.Extras.GetString(&quot;view&quot;);

        // Rest of code
    }
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Keep the Push Small</p>
<p>You should keep the push payload as small as possible.  There are limits and they vary by platform (but are in the range of 4-5Kb).  Note that I don't
include the full URL of the picture, for example, nor do I include the picture as binary data.  This allows me to adjust to an appropriate image URL
within the client.  This keeps the number of bytes in the push small, but also allows me to adjust the image for the platform, if necessary.</p>
</div>
<h2 id="geofenced-push">Geofenced Push<a class="headerlink" href="#geofenced-push" title="Permanent link">&para;</a></h2>
<p>This is a variation on the marketing push.  You want to send a marketing message, but only to those users that are within a certain geography.
This is known as geofencing.</p>
<h2 id="push-to-sync">Push to Sync<a class="headerlink" href="#push-to-sync" title="Permanent link">&para;</a></h2>
<p>Sometimes, you want to alert the user that there is something new for that user.  When the user is alerted, acceptance of the push notification
indicates that the user wants to go to the app and synchronize the database before viewing the data.</p>
<h2 id="secure-push">Secure Push<a class="headerlink" href="#secure-push" title="Permanent link">&para;</a></h2>
<p>Push notifications are insecure.  They appear on the front page of the lock screen and anyone can open them in a multi-user environment (where a
mobile device is shared by a community of users).  In these cases, you may want to ensure that the push notification is only opened by the user
for which it was intended.</p>
<!-- Links -->
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../windows/" title="Windows Push">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Windows Push
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../../chapter6/mvc/" title="MVC Applications">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                MVC Applications
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = 'adrianhall/develop-mobile-apps-with-csharp-and-azure';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
      <script src="../../js/highlight.pack.js"></script>
    
    
  </body>
</html>